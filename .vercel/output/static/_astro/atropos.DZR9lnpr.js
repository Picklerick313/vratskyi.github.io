function Q(){return Q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},Q.apply(this,arguments)}var Y=function(t,e){return t.querySelector(e)},$t=function(t,e){return t.querySelectorAll(e)},Xt=function(t){void 0===t&&(t={});var e={};return Object.keys(t).forEach((function(o){typeof t[o]<"u"&&(e[o]=t[o])})),e},Yt={alwaysActive:!1,activeOffset:50,shadowOffset:50,shadowScale:1,duration:300,rotate:!0,rotateTouch:!0,rotateXMax:15,rotateYMax:15,rotateXInvert:!1,rotateYInvert:!1,stretchX:0,stretchY:0,stretchZ:0,commonOrigin:!0,shadow:!0,highlight:!0};function Tt(t){void 0===t&&(t={});var e,o,a,n,r,i,s,p,c,u,l,f,d=t,h=d.el,v=d.eventsEl,m=t.isComponent,y={__atropos__:!0,params:Q({},Yt,{onEnter:null,onLeave:null,onRotate:null},Xt(t||{})),destroyed:!1,isActive:!1},g=y.params,M=[];!function t(){f=requestAnimationFrame((function(){M.forEach((function(t){if("function"==typeof t)t();else{var e=t.element,o=t.prop,a=t.value;e.style[o]=a}})),M.splice(0,M.length),t()}))}();var x,O=function(t,e){M.push({element:t,prop:"transitionDuration",value:e})},w=function(t,e){M.push({element:t,prop:"transitionTimingFunction",value:e})},X=function(t,e){M.push({element:t,prop:"transform",value:e})},b=function(t,e){M.push({element:t,prop:"opacity",value:e})},T=function(t,e,o,a){return t.addEventListener(e,o,a)},_=function(t,e,o,a){return t.removeEventListener(e,o,a)},L=function(t){var o=t.rotateXPercentage,a=void 0===o?0:o,n=t.rotateYPercentage,r=void 0===n?0:n,i=t.duration,s=t.opacityOnly,p=t.easeOut;$t(e,"[data-atropos-offset], [data-atropos-opacity]").forEach((function(t){O(t,i),w(t,p?"ease-out":"");var e=function(t){if(t.dataset.atroposOpacity&&"string"==typeof t.dataset.atroposOpacity)return t.dataset.atroposOpacity.split(";").map((function(t){return parseFloat(t)}))}(t);if(0===a&&0===r)s||X(t,"translate3d(0, 0, 0)"),e&&b(t,e[0]);else{var o=parseFloat(t.dataset.atroposOffset)/100;if(!Number.isNaN(o)&&!s&&X(t,"translate3d("+-r*-o+"%, "+a*-o+"%, 0)"),e){var n=e[0],c=e[1],u=Math.max(Math.abs(a),Math.abs(r));b(t,n+(c-n)*u/100)}}}))},A=function(t,e){var a=h!==v;if(r||(r=h.getBoundingClientRect()),a&&!i&&(i=v.getBoundingClientRect()),typeof t>"u"&&typeof e>"u"){var n=a?i:r;t=n.left+n.width/2,e=n.top+n.height/2}var s,c=0,u=0,l=r,f=l.top,d=l.left,m=l.width,y=l.height;if(a){var Y=i,x=Y.top,T=Y.left,_=Y.width,A=Y.height,E=m/2+(d-T),R=y/2+(f-x),I=t-T,P=e-x;u=g.rotateYMax*(I-E)/(_-m/2)*-1,c=g.rotateXMax*(P-R)/(A-y/2),s=t-d+"px "+(e-f)+"px"}else{var j=m/2,C=y/2,D=t-d,F=e-f;u=g.rotateYMax*(D-j)/(m/2)*-1,c=g.rotateXMax*(F-C)/(y/2)}c=Math.min(Math.max(-c,-g.rotateXMax),g.rotateXMax),g.rotateXInvert&&(c=-c),u=Math.min(Math.max(-u,-g.rotateYMax),g.rotateYMax),g.rotateYInvert&&(u=-u);var N=c/g.rotateXMax*100,Q=u/g.rotateYMax*100,S=(a?Q/100*g.stretchX:0)*(g.rotateYInvert?-1:1),k=(a?N/100*g.stretchY:0)*(g.rotateXInvert?-1:1),q=a?Math.max(Math.abs(N),Math.abs(Q))/100*g.stretchZ:0;X(o,"translate3d("+S+"%, "+-k+"%, "+-q+"px) rotateX("+c+"deg) rotateY("+u+"deg)"),s&&g.commonOrigin&&function(t,e){M.push({element:t,prop:"transformOrigin",value:e})}(o,s),p&&(O(p,g.duration+"ms"),w(p,"ease-out"),X(p,"translate3d("+.25*-Q+"%, "+.25*N+"%, 0)"),b(p,Math.max(Math.abs(N),Math.abs(Q))/100)),L({rotateXPercentage:N,rotateYPercentage:Q,duration:g.duration+"ms",easeOut:!0}),"function"==typeof g.onRotate&&g.onRotate(c,u)},E=function(){M.push((function(){return h.classList.add("atropos-active")})),O(o,g.duration+"ms"),w(o,"ease-out"),X(a,"translate3d(0,0, "+g.activeOffset+"px)"),O(a,g.duration+"ms"),w(a,"ease-out"),s&&(O(s,g.duration+"ms"),w(s,"ease-out")),y.isActive=!0},R=function(t){if(c=void 0,!("pointerdown"===t.type&&"mouse"===t.pointerType||"pointerenter"===t.type&&"mouse"!==t.pointerType)){if("pointerdown"===t.type&&t.preventDefault(),u=t.clientX,l=t.clientY,g.alwaysActive)return r=void 0,void(i=void 0);E(),"function"==typeof g.onEnter&&g.onEnter()}},I=function(t){!1===c&&t.cancelable&&t.preventDefault()},P=function(t){if(g.rotate&&y.isActive){if("mouse"!==t.pointerType){if(!g.rotateTouch)return;t.preventDefault()}var e=t.clientX,o=t.clientY,a=e-u,n=o-l;if("string"==typeof g.rotateTouch&&(0!==a||0!==n)&&typeof c>"u"){if(a*a+n*n>=25){var r=180*Math.atan2(Math.abs(n),Math.abs(a))/Math.PI;c="scroll-y"===g.rotateTouch?r>45:90-r>45}!1===c&&(h.classList.add("atropos-rotate-touch"),t.cancelable&&t.preventDefault())}"mouse"!==t.pointerType&&c||A(e,o)}},j=function(t){if(r=void 0,i=void 0,y.isActive&&(!t||"pointerup"!==t.type||"mouse"!==t.pointerType)&&(!t||"pointerleave"!==t.type||"mouse"===t.pointerType)){if("string"==typeof g.rotateTouch&&c&&h.classList.remove("atropos-rotate-touch"),g.alwaysActive)return A(),"function"==typeof g.onRotate&&g.onRotate(0,0),void("function"==typeof g.onLeave&&g.onLeave());M.push((function(){return h.classList.remove("atropos-active")})),O(a,g.duration+"ms"),w(a,""),X(a,"translate3d(0,0, 0px)"),s&&(O(s,g.duration+"ms"),w(s,"")),p&&(O(p,g.duration+"ms"),w(p,""),X(p,"translate3d(0, 0, 0)"),b(p,0)),O(o,g.duration+"ms"),w(o,""),X(o,"translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"),L({duration:g.duration+"ms"}),y.isActive=!1,"function"==typeof g.onRotate&&g.onRotate(0,0),"function"==typeof g.onLeave&&g.onLeave()}},C=function(t){var e=t.target;!v.contains(e)&&e!==v&&y.isActive&&j()};return y.destroy=function(){y.destroyed=!0,cancelAnimationFrame(f),_(document,"click",C),_(v,"pointerdown",R),_(v,"pointerenter",R),_(v,"pointermove",P),_(v,"touchmove",I),_(v,"pointerleave",j),_(v,"pointerup",j),_(v,"lostpointercapture",j),delete h.__atropos__},"string"==typeof h&&(h=Y(document,h)),h&&(h.__atropos__||(typeof v<"u"?"string"==typeof v&&(v=Y(document,v)):v=h,e=m?h.parentNode.host:h,Object.assign(y,{el:h}),o=Y(h,".atropos-rotate"),a=Y(h,".atropos-scale"),n=Y(h,".atropos-inner"),h.__atropos__=y)),h&&v&&(g.shadow&&((s=Y(h,".atropos-shadow"))||((s=document.createElement("span")).classList.add("atropos-shadow"),x=!0),X(s,"translate3d(0,0,-"+g.shadowOffset+"px) scale("+g.shadowScale+")"),x&&o.appendChild(s)),g.highlight&&function(){var t;(p=Y(h,".atropos-highlight"))||((p=document.createElement("span")).classList.add("atropos-highlight"),t=!0),X(p,"translate3d(0,0,0)"),t&&n.appendChild(p)}(),g.rotateTouch&&("string"==typeof g.rotateTouch?h.classList.add("atropos-rotate-touch-"+g.rotateTouch):h.classList.add("atropos-rotate-touch")),Y(e,"[data-atropos-opacity]")&&L({opacityOnly:!0}),T(document,"click",C),T(v,"pointerdown",R),T(v,"pointerenter",R),T(v,"pointermove",P),T(v,"touchmove",I),T(v,"pointerleave",j),T(v,"pointerup",j),T(v,"lostpointercapture",j),g.alwaysActive&&(E(),A())),y}export{Tt as A};